<ng-template #popTemplate>
  <span i18n>Application version</span>: v{{(settingsService.settings | async).Environment.appVersion}}
  <ng-container *ngIf="(settingsService.settings | async).Environment.buildTime">
    <br/>
    <span i18n>Built at</span>: {{(settingsService.settings | async).Environment.buildTime | date:'medium' }}
  </ng-container>
  <ng-container *ngIf="(settingsService.settings | async).Environment.buildCommitHash">
    <br/>
    <span i18n>Git commit</span>: {{(settingsService.settings | async).Environment.buildCommitHash}}
  </ng-container>
</ng-template>
<app-frame>
  <div body class="container-fluid">

    <div class="card mb-4" *ngIf="notificationService.countedNotifications.length>0">
      <h5 class="card-header" i18n>
        Server notifications
      </h5>
      <div class="card-body">
        <ng-container *ngFor="let notification of notificationService.countedNotifications">

          <div class="alert alert-{{getCss(notification.type)}}" role="alert">
            ({{notification.count}}) {{notification.message}}
            <br *ngIf="notification.details"/>
            {{notification.details | json}}
            <ng-container *ngIf="notification.request">
              <br/>
              Request: "{{notification.request.method}}", url: "{{notification.request.url}}", status code:
              "{{notification.request.statusCode}}"
            </ng-container>
          </div>
        </ng-container>
      </div>

      <div class="card-footer" i18n>
        To dismiss these notifications, restart the server.
      </div>
    </div>
    <div class="form-horizontal">
      <div class="d-flex justify-content-between">
        <div>
          <a triggers="mouseenter:mouseleave"
             placement="bottom"
             [popover]="popTemplate"
             class="version"
             href="https://github.com/bpatrik/pigallery2/releases">
            <span
              i18n>App version:</span>&nbsp;<span>{{'v' + ((settingsService.settings | async).Environment.appVersion || '----')}}</span>
          </a>
        </div>
        <div class="mb-1">
          <label class="control-label align-self-end me-2" for="config-priority" i18n>Mode</label>
          <select class="form-select d-inline-block w-auto"
                  aria-label="Configuration priority"
                  [(ngModel)]="settingsService.configPriority"
                  (ngModelChange)="settingsService.configPriorityChanged()"
                  [class.bg-warning]="settingsService.configPriority === ConfigPriority.advanced"
                  [class.bg-danger]="settingsService.configPriority === ConfigPriority.underTheHood"
                  id="config-priority">
            <option class="bg-white"
                    *ngFor="let cp of configPriorities"
                    [ngValue]="cp.key">{{cp.value}}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-2 ">
        <nav class="nav flex-column sticky-top">
          <div class="card">
            <div class="card-body text-md-start text-center align-content-md-start align-content-center">
              <h5 i18n="title of left card in settings page that contains settings contents" class="card-title">
                Menu</h5>
              <button class="btn btn-link nav-link text-start py-md-1 px-md-0"
                      *ngFor="let s of contents; let i=index;"
                      (click)="scrollTo(i)"
                      [hidden]="!s.HasAvailableSettings">
                <span class="oi oi-{{s.icon}}"></span> {{s.Name}}
              </button>
            </div>
          </div>

        </nav>
      </div>
      <div class="col-md-10">
        <app-settings-template
                               *ngFor="let cp of configPaths"
                               #setting
                               #tmpl
                               icon="list"
                               [ConfigPath]="cp"
                               [hidden]="!tmpl.HasAvailableSettings"></app-settings-template>
     <!--   <app-settings-template #setting #server
                               icon="list"
                               [ConfigPath]="'Server'"
                               [hidden]="!server.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #users
                               icon="person"
                               [ConfigPath]="'Users'"
                               [hidden]="!users.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #db
                               icon="list"
                               [ConfigPath]="'Database'"
                               [hidden]="!db.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #media
                               icon="camera-slr"
                               [ConfigPath]="'Media'"
                               [hidden]="!media.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #gallery
                               icon="browser"
                               [ConfigPath]="'Gallery'"
                               [hidden]="!gallery.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #preview
                               icon="image"
                               [ConfigPath]="'Preview'"
                               [hidden]="!preview.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #metafile
                               icon="file"
                               [ConfigPath]="'MetaFile'"
                               [hidden]="!metafile.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #map
                               icon="map-marker"
                               [ConfigPath]="'Map'"
                               [hidden]="!map.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #sharing
                               icon="share"
                               [ConfigPath]="'Sharing'"
                               [hidden]="!sharing.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #faces
                               icon="people"
                               [ConfigPath]="'Faces'"
                               [hidden]="!faces.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #album
                               icon="grid-two-up"
                               [ConfigPath]="'Album'"
                               [hidden]="!album.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #randomPhoto
                               icon="random"
                               [ConfigPath]="'RandomPhoto'"
                               [hidden]="!randomPhoto.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #duplicates
                               icon="layers"
                               [ConfigPath]="'Duplicates'"
                               [hidden]="!duplicates.HasAvailableSettings"></app-settings-template>
        <app-settings-template #setting #indexing
                               icon="pie-chart"
                               [ConfigPath]="'Indexing'"
                               [hidden]="!indexing.HasAvailableSettings"></app-settings-template>-->
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-12">
        <div class="text-end">
          <ng-container i18n>Up time</ng-container><!--
            -->: {{(settingsService.settings | async).Environment.upTime | date:'medium'}}
        </div>
      </div>
    </div>

  </div>
</app-frame>
